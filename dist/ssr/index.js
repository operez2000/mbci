void 0===process.env.NODE_ENV&&(process.env.NODE_ENV="production"),(()=>{var e={118:e=>{e.exports.UY=function(e){return e},e.exports.h5=function(e){return e}},599:(e,o,a)=>{"use strict";a.r(o),a.d(o,{default:()=>t});const n=require("compression");var r=a.n(n);const t=(0,a(118).UY)((({app:e})=>{e.use(r()({threshold:0}))}))},915:e=>{e.exports={server:{host:"localhost",userName:"root",password:"",database:"mbci"}}},97:(e,o,a)=>{"use strict";a.r(o),a.d(o,{default:()=>v});var n=a(118),r=a(146),t=a.n(r);const i=require("sequelize");var s=a.n(i);require("axios");const l=require("sha1");var d=a.n(l),c=a(915);const u=require("fs");var y=a.n(u);const p=require("nodemailer");var b=a.n(p);require("console");const m=a(116)("AC11ff4a5b66c56690bfb6ef2675c403cc","836c59c88f65ac157755a194a4acd414"),g=new(s())({dialect:"mysql",host:c.server.host,username:c.server.userName,password:c.server.password,database:c.server.database,logging:!1,timezone:"-07:00",dialectOptions:{multipleStatements:!0,dateStrings:!0,typeCast:!0}}),f={service:"gmail",host:"smtp.gmail.com",auth:{user:"segurosbinacional@gmail.com",pass:"Elsaysergio19"},tls:{rejectUnauthorized:!1}},h=(e,o,a)=>{o.setHeader("Access-Control-Allow-Origin","*"),o.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),o.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept, x-access-token, Authorization"),o.setHeader("Access-Control-Allow-Credentials",!0),console.log("-------------------------------------------------------"),console.log((new Date).toLocaleString("es-MX",{timeZone:"America/Tijuana"})),console.log("req.query",e.query),console.log("req.body",e.body),console.log("req.params",e.params),a()},E=(e,o,a)=>{let n=`Error en /api/${a} | Método ${o} \r\n`;return e.code&&(n+=e.code+"\r\n"),e.message&&(n+=e.message),n},$=e=>{for(var o=(new Date).getTime(),a=0;a-o<e;)a=(new Date).getTime()},v=(0,n.UY)((async({app:e})=>{e.use(t().json({limit:"50mb",extended:!0})),e.use(t().urlencoded({limit:"50mb",extended:!0})),e.use("/api/test",h,((e,o)=>{o.json({response:200,msg:"Ok"}),(async e=>{let o,a=null,n=null,r=(new Date).toLocaleString("fr-FR").replace(/\//g,"-");e.subject=`Póliza ${e.poliza}`,e.body=`\n    <div style="font-family: Verdana;">\n      Hola <strong>${e.asegurado}</strong>: <br><br>\n      <p style="text-align: justify; text-justify: inter-word;">\n        <strong>My Best Car Insurance</strong> agradece mucho la compra de tu Póliza #${e.poliza} para tu\n        ${e.marca} ${e.descripcion} ${e.modelo}, ésta Póliza vence en ${e.fExpiracion}\n        por ello tenemos una propuesta para ti. Queremos que siempre estés protegido y no te quedes sin cobertura.\n      </p>\n      Llámanos a:\n      <ul>\n        <li>(USA) 858 910 2149</li>\n        <li>(México) 664 904 0055</li>\n      </ul>\n      para resolver todas tus dudas y darte el servicio y protección que mereces.<br>\n      <p>\n        Presiona <a href="${e.liga}">Aqui</a> para descargar tu Póliza en formato PDF.\n      </p>\n      <p>Muchas gracias.</p>\n    </div>\n    `,console.log("Iniciando envío",r,"email",e.email,"subject",e.subject);try{n={from:`My Best Car Insurance ${f.auth.user}`,to:e.email,cc:e.cc,subject:e.subject,html:e.body},a=b().createTransport(f),o=await a.sendMail(n),console.log("Aceptado:",o.accepted,o.accepted.length),o.accepted.length>0?console.log("accepted",o.accepted):console.log("Not accepted"),o.rejected.length>0&&console.log("Rechazados",o.rejected),$(1500)}catch(e){console.log("Error al enviar correo sendEmail() (catch)\r\n",e);let o="object"==typeof e?JSON.stringify(e):e;y().writeFileSync("error-envio.log",`${r}\r\n ${o}\r\n`,{flag:"a"})}finally{console.log("finally en sendEmail()",r),console.log("---------------------------------------------------------------"),$(1200)}})({email:"operez2000@gmail.com",cc:"opereznet@hotmail.com",subject:"Subject de Prueba",asegurado:"Cliente de Prueba",poliza:"123456",marca:"Marca",descripcion:"Descripción",modelo:"Modelo",fExpiracion:"2022-01-13",liga:"www.google.com"})})),e.use("/api/aseguradoras",h,((e,o)=>{let a={};g.query("\n      SELECT id, nombre, web, contacto1, contacto2, email1, email2, initData\n      FROM aseguradoras\n      ORDER BY nombre\n    ").then((([e,o])=>{a.result=e.length>0?200:500,a.results=e,a.msg=e.length>0?"Ok":"No se encontraron registros"})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o})).finally((()=>{o.json(a)}))})),e.post("/api/poliza",h,(async(e,o)=>{let a,n,r={};e.body.fecha=e.body.fecha&&null!=e.body.fecha&&null!=e.body.fecha&&"Invalid Date"!=e.body.fecha?`'${e.body.fecha}'`:null,e.body.fEfectiva=e.body.fEfectiva&&null!=e.body.fEfectiva&&null!=e.body.fEfectiva&&"Invalid Date"!=e.body.fEfectiva?`'${e.body.fEfectiva}'`:null,e.body.fExpiracion=e.body.fExpiracion&&null!=e.body.fExpiracion&&null!=e.body.fExpiracion&&"Invalid Date"!=e.body.fExpiracion?`'${e.body.fExpiracion}'`:null,e.body.fCancelacion=e.body.fCancelacion&&null!=e.body.fCancelacion&&null!=e.body.fCancelacion&&"Invalid Date"!=e.body.fCancelacion?`'${e.body.fCancelacion}'`:null,e.body.fNacimiento=e.body.fNacimiento&&null!=e.body.fNacimiento&&null!=e.body.fNacimiento&&"Invalid Date"!=e.body.fNacimiento?`'${e.body.fNacimiento}'`:null;try{a=`\n        SELECT id FROM polizas WHERE (idAseguradora = ${e.body.idAseguradora}) AND (referencia = '${e.body.referencia}')\n      `,r.qry=a,n=await g.query(a),console.log("results",n),n[0]&&0==n[0].length?a=`\n          INSERT INTO polizas (\n            idAseguradora,\n            poliza,\n            referencia,\n            producto,\n            descProducto,\n            tipo,\n            fecha,\n            asegurado,\n            fEfectiva,\n            fExpiracion,\n            agente,\n            vendedor,\n            neto,\n            tarifa,\n            totalPoliza,\n            tarifaAgente,\n            tarifaProceso,\n            refUID,\n            metodoPago,\n            estatus,\n            fCancelacion,\n            tipoVehiculo,\n            valorDeclarado,\n            modelo,\n            marca,\n            descripcion,\n            vin,\n            placas,\n            fNacimiento,\n            territorio,\n            domicilio,\n            ciudad,\n            estado,\n            cp,\n            telefono,\n            email,\n            fechaRegistro\n          )\n          VALUES (\n            ${e.body.idAseguradora},\n            '${e.body.poliza}',\n            '${e.body.referencia}',\n            '${e.body.producto}',\n            '${e.body.descProducto}',\n            '${e.body.tipo}',\n            ${e.body.fecha},\n            '${e.body.asegurado}',\n            ${e.body.fEfectiva},\n            ${e.body.fExpiracion},\n            '${e.body.agente}',\n            '${e.body.vendedor}',\n            ${e.body.neto},\n            ${e.body.tarifa},\n            ${e.body.totalPoliza},\n            ${e.body.tarifaAgente},\n            ${e.body.tarifaProceso},\n            '${e.body.refUID}',\n            '${e.body.metodoPago}',\n            '${e.body.estatus}',\n            ${e.body.fCancelacion},\n            '${e.body.tipoVehiculo}',\n            ${e.body.valorDeclarado},\n            '${e.body.modelo}',\n            '${e.body.marca}',\n            '${e.body.descripcion}',\n            '${e.body.vin}',\n            '${e.body.placas}',\n            ${e.body.fNacimiento},\n            '${e.body.territorio}',\n            '${e.body.domicilio}',\n            '${e.body.ciudad}',\n            '${e.body.estado}',\n            '${e.body.cp}',\n            '${e.body.telefono}',\n            '${e.body.email}',\n            current_timestamp()\n          );\n        `:(e.body.referencia,e.body.producto,e.body.descProducto,e.body.tipo,e.body.fecha,e.body.asegurado,e.body.fEfectiva,e.body.fExpiracion,e.body.agente,e.body.vendedor,e.body.neto,e.body.tarifa,e.body.totalPoliza,e.body.tarifaAgente,e.body.tarifaProceso,e.body.refUID,e.body.metodoPago,e.body.estatus,e.body.fCancelacion,e.body.tipoVehiculo,e.body.valorDeclarado,e.body.modelo,e.body.marca,e.body.descripcion,e.body.vin,e.body.placas,e.body.fNacimiento,e.body.territorio,e.body.domicilio,e.body.ciudad,e.body.estado,e.body.cp,e.body.telefono,e.body.email,e.body.idAseguradora,e.body.referencia),n=await g.query(a),r.result=200,r.msg="Ok",r.results=await n}catch(o){r.result=404,r.msg=E(o,e.route.stack[0].method,e.route.path),r.results=o,y().writeFileSync("errorCarga.log",`${fecha}\r\n ${r.msg}\r\n`,{flag:"a"})}finally{o.json(r)}})),e.get("/api/polizas",h,((e,o)=>{let a={},n=`\n      SELECT\n        p.id, poliza, referencia, descProducto, date_format(fecha, '%Y-%m-%d') fecha, asegurado, telefono, email, date_format(fEfectiva, '%Y-%m-%d') fEfectiva,\n        date_format(fExpiracion, '%Y-%m-%d') fExpiracion, datediff( now(), fExpiracion) diasExpiracion, vendedor, totalPoliza, valorDeclarado,\n        tipo, modelo, marca, descripcion, vin, CASE WHEN p.fCancelacion IS NULL THEN '' ELSE Date_Format(p.fCancelacion, '%Y-%m-%d') END fCancelacion,\n        CASE WHEN p.fNacimiento IS NULL THEN '' ELSE Date_Format(p.fNacimiento, '%Y-%m-%d') END fNacimiento,\n        CASE WHEN p.ultimoEmail IS NULL THEN '' ELSE Date_Format(p.ultimoEmail, '%Y-%m-%d %H:%i') END ultimoEmail,\n        CASE WHEN p.ultimoSMS IS NULL THEN '' ELSE Date_Format(p.ultimoSMS, '%Y-%m-%d %H:%i') END ultimoSMS,\n        CASE WHEN p.ultimoWhatsApp IS NULL THEN '' ELSE Date_Format(p.ultimoWhatsApp, '%Y-%m-%d %H:%i') END ultimoWhatsApp\n      FROM polizas p\n      WHERE p.idAseguradora = ${e.query.idAseguradora||1}\n      ORDER BY p.id\n    `;g.query(n).then((([e])=>{a.result=e.length>0?200:500,a.msg=e.length>0?"Ok":"No se encontraron registros",a.results=e})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o})).finally((()=>{o.json(a)}))})),e.post("/api/login",h,((e,o)=>{let a={},n=`\n      SELECT u.id_usuario, u.usuario, u.nombre, u.email, u.telefono, u.id_perfil, p.nombre perfil\n      FROM usuarios u\n        INNER JOIN perfiles p ON u.id_perfil = p.id_perfil\n      WHERE ( (u.usuario = '${e.body.userId}') OR (u.email = '${e.body.userId}') ) AND (u.password = '${d()(e.body.password)}')\n    `;g.query(n).then((([e,o])=>{a.result=e.length>0?200:500,a.results=e,a.msg=e.length>0?"Ok":"Usuario inexistente"})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o})).finally((()=>{o.json(a)}))})),e.post("/api/pass",h,((e,o)=>{let a={},n=`SELECT password FROM usuarios WHERE usuario = '${e.body.userId}'`;g.query(n).then((([e,o])=>{a.result=e.length>0?200:500,a.results=e.length>0?e[0]:"",a.msg=e.length>0?"Ok":"No existe"})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o})).finally((()=>{o.json(a)}))})),e.post("/api/update_pass",h,((e,o)=>{let a={},n=`UPDATE usuarios SET password = '${e.body.pass}' WHERE usuario = '${e.body.usuario}' `;g.query(n).then((([e,o])=>{a.result=200,a.results=e,a.msg="La contraseña se actualizó correctamente"})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o})).finally((()=>{o.json(a)}))})),e.get("/api/usuarios",h,((e,o)=>{let a={},n="\n      SELECT\n        CAST(u.id_usuario AS character) id_usuario, u.usuario, u.nombre, u.email, u.telefono, u.id_perfil, p.nombre perfil\n      FROM usuarios u\n        INNER JOIN perfiles p ON u.id_perfil = p.id_perfil\n    ";e.query.id_usuario&&""!=e.query.id_usuario?n+=`WHERE id_usuario = ${e.query.id_usuario} `:e.query.usuario&&""!=e.query.usuario&&(n+=`WHERE usuario = '${e.query.usuario}' `),n+="ORDER BY u.nombre",g.query(n).then((([e,o])=>{a.result=0==e.length?500:200,a.msg=0==e.length?"No se encontraron Usuarios":"Usuarios: "+e.length,a.results=e})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o})).finally((()=>{o.json(a)}))})),e.post("/api/usuario_save",h,((e,o)=>{let a={},n=d()(e.body.password),r="";r=e.body.nuevoRegistro?`\n        INSERT INTO usuarios\n          (usuario, password, nombre, email, telefono, id_perfil, fecha)\n        VALUES\n          ('${e.body.usuario}', '${n}', '${e.body.nombre}', '${e.body.email}', '${e.body.telefono}', '${e.body.id_perfil}', NOW() )\n        ON DUPLICATE KEY UPDATE usuario='${e.body.usuario}', nombre='${e.body.nombre}', email='${e.body.email}', telefono='${e.body.telefono}', id_perfil='${e.body.id_perfil}'\n      `:`\n        UPDATE usuarios\n        SET usuario = '${e.body.usuario}', nombre = '${e.body.nombre}', email = '${e.body.email}', telefono = '${e.body.telefono}', id_perfil = '${e.body.id_perfil}'\n        WHERE id_usuario = ${e.body.id_usuario}\n      `,g.query(r).then((([e,o])=>{a.result=200,a.results=e,a.msg="Ok"})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o,a.qry=r})).finally((()=>{o.json(a)}))})),e.use("/api/perfiles",h,((e,o)=>{let a={};g.query("\n      SELECT *\n      FROM perfiles\n    ").then((([e,o])=>{a.result=0==e.length?500:200,a.msg=0==e.length?"No se encontraron Perfiles":"Perfiles: "+e.length,a.results=e})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o})).finally((()=>{o.json(a)}))})),e.post("/api/enviarEmail",h,(async(e,o)=>{let a,n,r,t,i=(new Date).toLocaleString("fr-FR").replace(/\//g,"-"),s={};console.log("Iniciando envío por Email",i,"email",e.body.email,"subject",e.body.subject);try{"vencimiento"==e.body.tipoEnvio?(e.body.subject=`Renew your Policy ${e.body.referencia} / Renueva tu Póliza ${e.body.referencia} `,e.body.body=`\n          <div style="font-family: Verdana;">\n            Hello <strong>${e.body.asegurado}</strong>: <br>\n            <p style="text-align: justify; text-justify: inter-word;">\n              Your Policy #${e.body.referencia} for your car\n              ${e.body.marca} ${e.body.descripcion} ${e.body.modelo} expires in ${e.body.fExpiracion} therefore we have a proposal for you. We want you to always be protected and not be left without coverage.\n            </p>\n\n        `,1==e.body.idAseguradora&&(e.body.body+=`\n            <p>\n              Press <a href="${e.body.liga}">Here</a> to download your Policy in PDF format.\n            </p>\n            `),e.body.body+=`\n            <p> Thank you very much.</p>\n            <hr><br>\n            Hola <strong>${e.body.asegurado}</strong>: <br>\n            <p style="text-align: justify; text-justify: inter-word;">\n              Tu Póliza #${e.body.referencia} para tu auto ${e.body.marca} ${e.body.descripcion} ${e.body.modelo} vence en ${e.body.fExpiracion}\n              por ello tenemos una propuesta para ti. Queremos que siempre estés protegido y no te quedes sin cobertura.\n            </p>\n        `,1==e.body.idAseguradora&&(e.body.body+=`\n            <p>\n              Presiona <a href="${e.body.liga}">Aquí</a> para descargar tu Póliza en formato PDF.\n            </p>\n          `),e.body.body+="\n            <p>Muchas gracias.</p>\n          </div>\n        ",e.body.body+='\n    <div style="font-family: Verdana; font-size: 0.85em;">\n      <br><hr>\n      Please call us at / Llámanos a:\n      <ul>\n        <li> (USA) 858 910 2149 </li>\n        <li> (Mexico) 664 904 0055 </li>\n      </ul>\n      to solve all your doubts and give you the service and protection you deserve. / Para resolver todas tus dudas y darte el servicio y protección que mereces.<br>\n      Visit us at <strong>mybestcarinsurance.com</strong><br><br>\n\n      <hr>\n\n      <p>Please scan the following QR codes and buy your Tourist Car Policy / Escanea los siguientes códigos QR y compra tu Póliza de Auto Turista:</p>\n\n      <img src="cid:qr_chubb" width="200" alt="Cotizador / Free Quote" />\n      <img src="cid:qr_gnp" width="200" alt="Cotizador / Free Quote" />\n      <br>\n      <img src="cid:logo_verde" width="300" alt="" />\n      <br>\n      <img src="cid:logos" width="200" alt="" />\n      <br><br>\n      <p></p>\n      <p>Follow us at: / Siguenos en:</p>\n      <a href="https://www.facebook.com/segurosdeautotijuana/">\n        <img src="cid:facebook" width="50" alt="" />\n      </a>\n      <a href="https://www.instagram.com/mybestcarinsurance/">\n        <img src="cid:instagram" width="50" alt="" />\n      </a>\n      <a href="https://l.facebook.com/l.php?u=https%3A%2F%2Fapi.whatsapp.com%2Fsend%3Fphone%3D16198563255%26app%3Dfacebook%26entry_point%3Dpage_cta%26fbclid%3DIwAR0Ak4HdMSEqEKGljWhJVbRRXn9oJNhi8CBd7jSoziOlMzemXqDI0Mt7fKc&h=AT1mJCSX8trLTH96M7mfmV8EoD1LcDSvmhC7tL6JGphJToYeopyZCMKfIQv_Nw9gJF28qCNU7XqpmAyXjzFdvPo8JekTdMCeXbFxWME3KViUoOCuYiMMEkoo4ytaVPGusP_p4zAN4-yBBQH-ye85irJrWggwd2A2">\n        <img src="cid:whatsapp" width="50" alt="" />\n      </a>\n      <br>\n    </div>\n  '):"agradecimiento"==e.body.tipoEnvio?(e.body.subject=`Thanks for your purchase of Policy ${e.body.referencia} / Gracias por la compra de tu Póliza ${e.body.referencia} `,e.body.body=`\n          <div style="font-family: Verdana;">\n            Hello <strong>${e.body.asegurado}</strong>: <br>\n            <p style="text-align: justify; text-justify: inter-word;">\n              <strong>My Best Car Insurance</strong> appreciates the purchase of your Policy #${e.body.referencia} for your car\n              ${e.body.marca} ${e.body.descripcion} ${e.body.modelo}, this Policy expires in ${e.body.fExpiracion}.\n        `,1==e.body.idAseguradora&&(e.body.body+=`\n            We are sending it to you <a href="${e.body.liga}">here</a> so you can always be protected.\n          `),e.body.body+=`\n              It is an honor to have clients like you.\n            </p>\n            <p> Thank you very much.</p><br>\n            <hr><br>\n            Hola <strong>${e.body.asegurado}</strong>: <br>\n            <p style="text-align: justify; text-justify: inter-word;">\n              <strong>My Best Car Insurance</strong> agradece mucho la compra de tu Póliza #${e.body.referencia} para tu auto\n              ${e.body.marca} ${e.body.descripcion} ${e.body.modelo}, ésta Póliza vence en ${e.body.fExpiracion}.\n        `,1==e.body.idAseguradora&&(e.body.body+=`\n            <a href="${e.body.liga}">Aquí</a> te la enviamos para que la tengas a la mano y siempre estés protegido/a.<br>\n          `),e.body.body+="\n              Es un honor tener clientes como tú.\n            </p>\n            <p>Muchas gracias.</p>\n          </div>\n        ",e.body.body+='\n    <div style="font-family: Verdana; font-size: 0.85em;">\n      <br><hr>\n      Please call us at / Llámanos a:\n      <ul>\n        <li> (USA) 858 910 2149 </li>\n        <li> (Mexico) 664 904 0055 </li>\n      </ul>\n      to solve all your doubts and give you the service and protection you deserve. / Para resolver todas tus dudas y darte el servicio y protección que mereces.<br>\n      Visit us at <strong>mybestcarinsurance.com</strong><br><br>\n\n      <hr>\n\n      <p>Please scan the following QR codes and buy your Tourist Car Policy / Escanea los siguientes códigos QR y compra tu Póliza de Auto Turista:</p>\n\n      <img src="cid:qr_chubb" width="200" alt="Cotizador / Free Quote" />\n      <img src="cid:qr_gnp" width="200" alt="Cotizador / Free Quote" />\n      <br>\n      <img src="cid:logo_verde" width="300" alt="" />\n      <br>\n      <img src="cid:logos" width="200" alt="" />\n      <br><br>\n      <p></p>\n      <p>Follow us at: / Siguenos en:</p>\n      <a href="https://www.facebook.com/segurosdeautotijuana/">\n        <img src="cid:facebook" width="50" alt="" />\n      </a>\n      <a href="https://www.instagram.com/mybestcarinsurance/">\n        <img src="cid:instagram" width="50" alt="" />\n      </a>\n      <a href="https://l.facebook.com/l.php?u=https%3A%2F%2Fapi.whatsapp.com%2Fsend%3Fphone%3D16198563255%26app%3Dfacebook%26entry_point%3Dpage_cta%26fbclid%3DIwAR0Ak4HdMSEqEKGljWhJVbRRXn9oJNhi8CBd7jSoziOlMzemXqDI0Mt7fKc&h=AT1mJCSX8trLTH96M7mfmV8EoD1LcDSvmhC7tL6JGphJToYeopyZCMKfIQv_Nw9gJF28qCNU7XqpmAyXjzFdvPo8JekTdMCeXbFxWME3KViUoOCuYiMMEkoo4ytaVPGusP_p4zAN4-yBBQH-ye85irJrWggwd2A2">\n        <img src="cid:whatsapp" width="50" alt="" />\n      </a>\n      <br>\n    </div>\n  '):"libre"==e.body.tipoEnvio?(e.body.subject="Dear Customer / Estimado Cliente ",e.body.body=e.body.txtLibre,e.body.body+='\n    <div style="font-family: Verdana; font-size: 0.85em;">\n      <br><hr>\n      Please call us at / Llámanos a:\n      <ul>\n        <li> (USA) 858 910 2149 </li>\n        <li> (Mexico) 664 904 0055 </li>\n      </ul>\n      to solve all your doubts and give you the service and protection you deserve. / Para resolver todas tus dudas y darte el servicio y protección que mereces.<br>\n      Visit us at <strong>mybestcarinsurance.com</strong><br><br>\n\n      <hr>\n\n      <p>Please scan the following QR codes and buy your Tourist Car Policy / Escanea los siguientes códigos QR y compra tu Póliza de Auto Turista:</p>\n\n      <img src="cid:qr_chubb" width="200" alt="Cotizador / Free Quote" />\n      <img src="cid:qr_gnp" width="200" alt="Cotizador / Free Quote" />\n      <br>\n      <img src="cid:logo_verde" width="300" alt="" />\n      <br>\n      <img src="cid:logos" width="200" alt="" />\n      <br><br>\n      <p></p>\n      <p>Follow us at: / Siguenos en:</p>\n      <a href="https://www.facebook.com/segurosdeautotijuana/">\n        <img src="cid:facebook" width="50" alt="" />\n      </a>\n      <a href="https://www.instagram.com/mybestcarinsurance/">\n        <img src="cid:instagram" width="50" alt="" />\n      </a>\n      <a href="https://l.facebook.com/l.php?u=https%3A%2F%2Fapi.whatsapp.com%2Fsend%3Fphone%3D16198563255%26app%3Dfacebook%26entry_point%3Dpage_cta%26fbclid%3DIwAR0Ak4HdMSEqEKGljWhJVbRRXn9oJNhi8CBd7jSoziOlMzemXqDI0Mt7fKc&h=AT1mJCSX8trLTH96M7mfmV8EoD1LcDSvmhC7tL6JGphJToYeopyZCMKfIQv_Nw9gJF28qCNU7XqpmAyXjzFdvPo8JekTdMCeXbFxWME3KViUoOCuYiMMEkoo4ytaVPGusP_p4zAN4-yBBQH-ye85irJrWggwd2A2">\n        <img src="cid:whatsapp" width="50" alt="" />\n      </a>\n      <br>\n    </div>\n  '):"masivo"==e.body.tipoEnvio&&(e.body.body=e.body.body.replace(/\n|\r/g,"<br>"),e.body.body+='\n    <div style="font-family: Verdana; font-size: 0.85em;">\n      <br><hr>\n      Please call us at / Llámanos a:\n      <ul>\n        <li> (USA) 858 910 2149 </li>\n        <li> (Mexico) 664 904 0055 </li>\n      </ul>\n      to solve all your doubts and give you the service and protection you deserve. / Para resolver todas tus dudas y darte el servicio y protección que mereces.<br>\n      Visit us at <strong>mybestcarinsurance.com</strong><br><br>\n\n      <hr>\n\n      <p>Please scan the following QR codes and buy your Tourist Car Policy / Escanea los siguientes códigos QR y compra tu Póliza de Auto Turista:</p>\n\n      <img src="cid:qr_chubb" width="200" alt="Cotizador / Free Quote" />\n      <img src="cid:qr_gnp" width="200" alt="Cotizador / Free Quote" />\n      <br>\n      <img src="cid:logo_verde" width="300" alt="" />\n      <br>\n      <img src="cid:logos" width="200" alt="" />\n      <br><br>\n      <p></p>\n      <p>Follow us at: / Siguenos en:</p>\n      <a href="https://www.facebook.com/segurosdeautotijuana/">\n        <img src="cid:facebook" width="50" alt="" />\n      </a>\n      <a href="https://www.instagram.com/mybestcarinsurance/">\n        <img src="cid:instagram" width="50" alt="" />\n      </a>\n      <a href="https://l.facebook.com/l.php?u=https%3A%2F%2Fapi.whatsapp.com%2Fsend%3Fphone%3D16198563255%26app%3Dfacebook%26entry_point%3Dpage_cta%26fbclid%3DIwAR0Ak4HdMSEqEKGljWhJVbRRXn9oJNhi8CBd7jSoziOlMzemXqDI0Mt7fKc&h=AT1mJCSX8trLTH96M7mfmV8EoD1LcDSvmhC7tL6JGphJToYeopyZCMKfIQv_Nw9gJF28qCNU7XqpmAyXjzFdvPo8JekTdMCeXbFxWME3KViUoOCuYiMMEkoo4ytaVPGusP_p4zAN4-yBBQH-ye85irJrWggwd2A2">\n        <img src="cid:whatsapp" width="50" alt="" />\n      </a>\n      <br>\n    </div>\n  '),n={from:`My Best Car Insurance ${f.auth.user}`,to:e.body.email,cc:e.body.cc,bcc:"ventaschaparral@mybestcarinsurance.com",subject:e.body.subject,html:e.body.body,attachments:[{filename:"logos.png",path:"public/logos.png",cid:"logos"},{filename:"logo_verde.jpeg",path:"public/logo_verde.jpeg",cid:"logo_verde"},{filename:"qr_chubb.png",path:"public/qr_chubb.png",cid:"qr_chubb"},{filename:"qr_gnp.png",path:"public/qr_gnp.png",cid:"qr_gnp"},{filename:"facebook.jpg",path:"public/facebook.jpg",cid:"facebook"},{filename:"instagram.jpg",path:"public/instagram.jpg",cid:"instagram"},{filename:"whatsapp.jpg",path:"public/whatsapp.jpg",cid:"whatsapp"}]},"masivo"==e.body.tipoEnvio&&n.attachments.push({filename:"guia_paisano_2021.pdf",path:"public/guia_paisano_2021.pdf",cid:"guia"}),a=b().createTransport(f),r=await a.sendMail(n),console.log("Aceptado:",r.accepted,r.accepted.length),s.result=200,s.msg="El envío se ha realizado correctamente",s.accepted=r.accepted,s.rejected=r.rejected,r.accepted.length>0&&("vencimiento"!=e.body.tipoEnvio&&"agradecimiento"!=e.body.tipoEnvio||(e.body.qry=`\n            UPDATE polizas\n            SET ultimoEmail = NOW()\n            WHERE id = ${e.body.id}\n          `,t=await g.query(e.body.qry),s.results=t[0],s.metadata=t[1],console.log("Resultados de la afectación en BD - metadata",s.metadata,"results",s.results),$(1500))),r.rejected.length>0&&(console.log("Rechazados",r.rejected),y().writeFileSync("rechazados.log",`${i}\r\n ${r.rejected.toString()}\r\n`,{flag:"a"}))}catch(e){let o="object"==typeof e?JSON.stringify(e):e;s.result=403,s.msg=o,console.log("Error al enviar correo sendEmail() (catch)",e),y().writeFileSync("error-envio.log",`${i}\r\n ${o}\r\n`,{flag:"a"})}finally{console.log("finally en /api/enviarEmail",i),console.log("---------------------------------------------------------------"),o.json(s)}})),e.post("/api/enviarSMS",h,(async(e,o)=>{let a,n,r=(new Date).toLocaleString("fr-FR").replace(/\//g,"-"),t={},i="";"SMS"==e.body.medio.toUpperCase()&&(e.body.medio=""),e.body.medio=e.body.medio?e.body.medio:"",e.body.telefono=("US"==e.body.pais.toUpperCase()?"+1":"+52")+e.body.telefono.replace(/-|[()]| /g,""),console.log("Iniciando envío por SMS",r),console.log("telefono",e.body.telefono);try{"vencimiento"==e.body.tipoEnvio?(i+=`Hello ${e.body.asegurado}: \r\n`,i+=`My Best Car Insurance appreciates the purchase of your Policy #${e.body.referencia} for your car `,i+=`${e.body.marca} ${e.body.descripcion} ${e.body.modelo}, this Policy expires in ${e.body.fExpiracion} `,i+="therefore we have a proposal for you. We want you to always be protected and not be left without coverage.\r\n",i+="Please call us at: \r\n",i+="  (USA) +1 858 910 2149 \r\n",i+="  (Mexico) +52 664 904 0055 \r\n",i+="to solve all your doubts and give you the service and protection you deserve.\r\n",i+=`Go to ${e.body.liga} to download your Policy in PDF format. \r\n`,i+="Thank you very much. \r\n",i+="\r\n----------------------\r\n",i+="\r\n",i+=`Hola ${e.body.asegurado}:  \r\n`,i+=`My Best Car Insurance agradece mucho la compra de tu Póliza #${e.body.referencia} para tu auto `,i+=`${e.body.marca} ${e.body.descripcion} ${e.body.modelo}, ésta Póliza vence en ${e.body.fExpiracion} `,i+="por ello tenemos una propuesta para ti. Queremos que siempre estés protegido y no te quedes sin cobertura.\r\n",i+="Llámanos a: \r\n",i+="  (USA) +1 858 910 2149 \r\n",i+="  (México) +52 664 904 0055 \r\n",i+="para resolver todas tus dudas y darte el servicio y protección que mereces.\r\n",i+=`Entra a ${e.body.liga} para descargar tu Póliza en formato PDF. \r\n`,i+="Muchas gracias. \r\n"):"agradecimiento"==e.body.tipoEnvio?(i+=`Hello ${e.body.asegurado}: \r\n`,i+=`My Best Car Insurance appreciates the purchase of your Policy #${e.body.referencia} for your car `,i+=`${e.body.marca} ${e.body.descripcion} ${e.body.modelo}, this Policy expires in ${e.body.fExpiracion} `,i+=`We are sending it to you ${e.body.liga} so you can always be protected. It is an honor to have clients like you.\r\n`,i+="Thank you very much. \r\n",i+="\r\n----------------------\r\n",i+="\r\n",i+=`Hola ${e.body.asegurado}:  \r\n`,i+=`My Best Car Insurance agradece mucho la compra de tu Póliza #${e.body.referencia} para tu auto `,i+=`${e.body.marca} ${e.body.descripcion} ${e.body.modelo}, ésta Póliza vence en ${e.body.fExpiracion} `,i+="por ello tenemos una propuesta para ti. Queremos que siempre estés protegido y no te quedes sin cobertura.\r\n",i+=`Aquí te la enviamos ${e.body.liga} para que la tengas a la mano y siempre estés protegido/a. Es un honor tener clientes como tú.\r\n`,i+="Muchas gracias. \r\n"):"masivo"==e.body.tipoEnvio&&(i+=e.body.body),e.body.body=i,console.log("body",e.body.body),t.body=e.body.body,t.telefono=e.body.telefono,n=await m.messages.create({body:e.body.body,from:`${e.body.medio}+17547142944`,to:`${e.body.medio}${e.body.telefono}`}),t.message=await n,t.result=200,t.rejected=[],t.accepted=["Ok"],"vencimiento"!=e.body.tipoEnvio&&"agradecimiento"!=e.body.tipoEnvio||(e.body.qry=`\n          UPDATE polizas\n          SET ultimoSMS = NOW()\n          WHERE id = ${e.body.id}\n        `,a=await g.query(e.body.qry),t.results=a[0],t.metadata=a[1],console.log("Resultados de la afectación en BD - metadata",t.metadata,"results",t.results),$(1500))}catch(e){console.log("Error al enviar SMS (catch)",e);let o="object"==typeof e?JSON.stringify(e):e;t.result=403,t.msg=o,y().writeFileSync("error-envio.log",`${r}\r\n ${o}\r\n`,{flag:"a"})}finally{console.log("finally en /api/enviarSMS",r),console.log("---------------------------------------------------------------"),o.json(t)}})),e.post("/api/cliente",h,(async(e,o)=>{let a,n={},r="",t=null;e.body.paterno||(e.body.paterno=""),e.body.materno||(e.body.materno=""),e.body.nombre||(e.body.nombre=""),e.body.nombreCompleto||(e.body.nombreCompleto=""),e.body.email||(e.body.email=""),e.body.telefono1||(e.body.telefono1=""),e.body.telefono2||(e.body.telefono2=""),e.body.domicilio||(e.body.domicilio=""),e.body.colonia||(e.body.colonia=""),e.body.cp||(e.body.cp=""),e.body.pais||(e.body.pais="");try{r=`\n        SELECT id FROM clientes WHERE email = '${e.body.email}'\n      `,a=await g.query(r),a[0]&&0==a[0].length?(n.accion="INSERT",r=`\n          INSERT INTO clientes\n            (paterno, materno, nombre, nombreCompleto, email, telefono1, telefono2, domicilio, colonia, cp, pais, fecha)\n          VALUES\n            ('${e.body.paterno}', '${e.body.materno}', '${e.body.nombre}', '${e.body.nombreCompleto}', '${e.body.email}',\n            '${e.body.telefono1}', '${e.body.telefono2}', '${e.body.domicilio}', '${e.body.colonia}', '${e.body.cp}',\n            '${e.body.pais}', NOW() )\n        `):(t=await a[0][0].id,n.accion="UPDATE",r=`\n          UPDATE clientes\n          SET paterno = '${e.body.paterno}',\n              materno = '${e.body.materno}',\n              nombre = '${e.body.nombre}',\n              nombreCompleto = '${e.body.nombreCompleto}',\n              email = '${e.body.email}',\n              telefono1 = '${e.body.telefono1}',\n              telefono2 = '${e.body.telefono2}',\n              domicilio = '${e.body.domicilio}',\n              colonia = '${e.body.colonia}',\n              cp = '${e.body.cp}',\n              pais = '${e.body.pais}'\n          WHERE id = ${t}\n        `),await g.query(r),n.result=200,n.msg="Ok",n.results=a}catch(o){n.result=403,n.msg=E(o,e.route.stack[0].method,e.route.path),n.results=[]}finally{o.json(n)}})),e.delete("/api/cliente/:id",h,((e,o)=>{let a={},n=`DELETE FROM clientes WHERE id = ${e.params.id}`;g.query(n).then((([e,o])=>{a.response=200,a.msg="Registro eliminado correctamente",a.results=o,console.log("meta",o)})).catch((o=>{a.response=403,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=[]})).finally((()=>{o.json(a)}))})),e.get("/api/polizas-clientes/:id",h,((e,o)=>{let a,n={};console.log("parametros",e.params.id),a=0==e.params.id?"\n        SELECT asegurado nombre, email, telefono, 'US' pais, idAseguradora\n        FROM polizas\n        UNION\n        SELECT nombreCompleto nombre, email, telefono1 telefono, pais, 999999999 idAseguradora\n        FROM clientes\n        ORDER BY nombre;\n      ":999999999==e.params.id?"\n        SELECT nombreCompleto nombre, email, telefono1 telefono, pais, 999999999 idAseguradora\n        FROM clientes\n        ORDER BY nombre;\n      ":`\n        SELECT asegurado nombre, email, telefono, 'US' pais, idAseguradora\n        FROM polizas\n        WHERE idAseguradora = ${e.params.id}\n      `,g.query(a).then((([e])=>{n.result=e.length>0?200:500;for(let o=0;o<e.length;o++)e[o].id=o+1;n.results=e,n.msg=e.length>0?"Ok":"No se encontraron registros"})).catch((o=>{n.result=404,n.msg=E(o,e.route.stack[0].method,e.route.path),n.results=o})).finally((()=>{o.json(n)}))})),e.get("/api/clientes",h,(async(e,o)=>{let a={};g.query("\n      SELECT id, nombreCompleto, email, telefono1, LOWER(pais) pais\n      FROM clientes\n      ORDER BY nombreCompleto\n    ").then((([e])=>{a.result=e.length>0?200:500,a.results=e,a.msg=e.length>0?"Ok":"No se encontraron registros"})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o})).finally((()=>{o.json(a)}))})),e.get("/api/cliente/:id",h,((e,o)=>{let a={},n=`\n      SELECT id, nombreCompleto, email, telefono1, LOWER(pais) pais\n      FROM clientes\n      WHERE id = ${e.params.id}\n    `;g.query(n).then((([e])=>{a.result=e.length>0?200:500,a.results=e,a.msg=e.length>0?"Ok":"No se encontraron registros"})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o})).finally((()=>{o.json(a)}))})),e.post("/api/cliente/:id",h,(async(e,o)=>{let a,n,r={};try{n=e.params.id?e.params.id:0,a=`\n        SELECT id\n        FROM clientes\n        WHERE id = ${n}\n      `,results=await g.query(a),a=results[0]&&0==results[0].length?`\n          INSERT INTO clientes (paterno, materno, nombre, nombreCompleto, email, telefono1, telefono2, domicilio, colonia, cp, pais, fecha)\n          VALUES ('', '', '', '${e.body.nombreCompleto}', '${e.body.email}', '${e.body.telefono1}', '', '', '', '', '', , '${e.body.pais}', NEW())\n        `:`\n          UPDATE clientes\n          SET nombreCompleto = '${e.body.nombreCompleto}',\n              email = '${e.body.email}',\n              telefono1 = '${e.body.telefono1}',\n              pais = '${e.body.pais}'\n          WHERE id = ${e.body.id}\n        `,g.query(a),r.result=200,r.msg="Registro guardado correctamente"}catch(o){r.result=404,r.msg=E(o,e.route.stack[0].method,e.route.path),r.results=o}})),e.put("/api/telEmail/:id",h,((e,o)=>{let a={},n=`\n      UPDATE polizas\n      SET email = '${e.body.email}',\n          telefono = '${e.body.telefono}'\n      WHERE id = ${e.params.id}\n    `;g.query(n).then((([e])=>{a.result=200,a.results=[],a.msg="Ok"})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o})).finally((()=>{o.json(a)}))})),e.delete("/api/poliza/:id",h,((e,o)=>{let a={},n=`\n      DELETE FROM polizas\n      WHERE id = ${e.params.id}\n    `;g.query(n).then((([e])=>{a.result=200,a.results=[],a.msg="Ok"})).catch((o=>{a.result=404,a.msg=E(o,e.route.stack[0].method,e.route.path),a.results=o})).finally((()=>{o.json(a)}))}))}))},100:(e,o,a)=>{"use strict";a.r(o),a.d(o,{default:()=>n});const n=(0,a(118).UY)((({app:e,resolve:o,render:a,serve:n})=>{e.get(o.urlPath("*"),((e,o)=>{o.setHeader("Content-Type","text/html"),a({req:e,res:o}).then((e=>{o.send(e)})).catch((e=>{e.url?e.code?o.redirect(e.code,e.url):o.redirect(e.url):404===e.code?o.status(404).send("404 | Page Not Found"):o.status(500).send("500 | Internal Server Error")}))}))}))},146:e=>{"use strict";e.exports=require("express")},116:e=>{"use strict";e.exports=require("twilio")}},o={};function a(n){var r=o[n];if(void 0!==r)return r.exports;var t=o[n]={exports:{}};return e[n](t,t.exports,a),t.exports}a.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return a.d(o,{a:o}),o},a.d=(e,o)=>{for(var n in o)a.o(o,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},a.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";a.d(n,{default:()=>A});const e=require("path");var o=a(146),r=a.n(o);const t=require("@vue/server-renderer"),i=require("@quasar/ssr-helpers/create-renderer");var s=a.n(i);const l=require("./render-template.js");var d=a.n(l);const c=require("./quasar.server-manifest.json");var u=a.n(c);const y=require("./quasar.client-manifest.json");var p=a.n(y);const b=(0,a(118).h5)((({app:e,port:o,isReady:a})=>a().then((()=>{e.listen(o,(()=>{console.log("Server listening at port "+o)}))})))),m=r()(),g=process.env.PORT||3001,f=e=>e||"/",h=__dirname,E=(0,e.join)(__dirname,"www");function $(){return(0,e.join)(E,...arguments)}const v=(e,o={})=>r().static($(e),{...o,maxAge:void 0===o.maxAge?2592e6:o.maxAge}),w=s()({vueRenderToString:t.renderToString,basedir:__dirname,serverManifest:u(),clientManifest:p(),manualStoreSerialization:!1});m.use(f("/"),v("."));const S={app:m,resolve:{urlPath:f,root(){return(0,e.join)(h,...arguments)},public:$},publicPath:"/",folders:{root:h,public:E},render:e=>w(e,d()),serve:{static:v}},C=(q=S,Promise.all([Promise.resolve().then(a.bind(a,599)),Promise.resolve().then(a.bind(a,97)),Promise.resolve().then(a.bind(a,100))]).then((async e=>{const o=e.map((e=>e.default));for(let e=0;e<o.length;e++)try{await o[e](q)}catch(e){return void console.error("[Quasar SSR] middleware error:",e)}})));var q;const P=()=>C,A=b({port:g,isReady:P,ssrHandler:(e,o,a)=>P().then((()=>m(e,o,a))),...S})})(),module.exports=n.default})();